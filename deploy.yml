recipes:
  - common

config:
  message:
    put: HapiDeploy is a remote execution tool written in Python, inspired by DeployPHP.
  node_version:
    put: 22.15.0
  python_versions:
    add:
      - '3.11'
      - '3.12'
      - '3.13'
  "bin/node":
    bind: |
      if c.test("[ ! -d $HOME/.nvm/versions/node/v{{node_version}} ]"):
        result = c.parse('export PATH="$HOME/.nvm/versions/node/v{{node_version}}/bin:$PATH"; node')
      else:
        result = '/usr/bin/node'
  release_dep_dir:
    bind: |
      if c.test('[ -d {{deploy_path}} ]'):
        result = c.parse("{{deploy_path}}/.dep")
      else:
        result = "/path/to/deploy"

tasks:
  sample:
    desc: 'This is sample task'
    run:
      - echo "{{message}}"
      - echo "{{bin/node}}"
      - echo "{{release_dep_dir}}"
